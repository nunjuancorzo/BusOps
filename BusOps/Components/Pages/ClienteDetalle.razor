@page "/clientes/nuevo"
@page "/clientes/{Id:int}"
@using BusOps.Models
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>@(Id == 0 ? "Nuevo Cliente" : "Editar Cliente") - BusOps</PageTitle>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>@(Id == 0 ? "Nuevo Cliente" : "Editar Cliente")</h1>
    <button class="btn btn-outline-secondary" @onclick="Volver">
        <i class="bi bi-arrow-left"></i> Volver
    </button>
</div>

<div class="card">
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Tipo de Cliente *</label>
                <select class="form-select" @bind="cliente.Tipo">
                    <option value="@TipoCliente.Particular">Particular</option>
                    <option value="@TipoCliente.Empresa">Empresa</option>
                    <option value="@TipoCliente.Agencia">Agencia</option>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">NIF/CIF *</label>
                <input type="text" class="form-control" @bind="cliente.NIF" />
            </div>
        </div>

        @if (cliente.Tipo == TipoCliente.Particular)
        {
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Nombre *</label>
                    <input type="text" class="form-control" @bind="cliente.Nombre" />
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Apellidos</label>
                    <input type="text" class="form-control" @bind="cliente.Apellidos" />
                </div>
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Nombre de la Empresa *</label>
                    <input type="text" class="form-control" @bind="cliente.NombreEmpresa" />
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Persona de Contacto</label>
                    <input type="text" class="form-control" @bind="cliente.Nombre" />
                </div>
            </div>
        }

        <div class="row">
            <div class="col-md-12 mb-3">
                <label class="form-label">Dirección</label>
                <input type="text" class="form-control" @bind="cliente.Direccion" />
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Ciudad</label>
                <input type="text" class="form-control" @bind="cliente.Ciudad" />
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Código Postal</label>
                <input type="text" class="form-control" @bind="cliente.CodigoPostal" />
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Teléfono *</label>
                <input type="text" class="form-control" @bind="cliente.Telefono" />
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Email *</label>
                <input type="email" class="form-control" @bind="cliente.Email" />
            </div>
        </div>

        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" @bind="cliente.Activo" id="activoCheck">
            <label class="form-check-label" for="activoCheck">
                Cliente activo
            </label>
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-primary" @onclick="Guardar">
                <i class="bi bi-save"></i> Guardar
            </button>
            <button class="btn btn-secondary" @onclick="Volver">
                Cancelar
            </button>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private Cliente cliente = new();

    protected override void OnInitialized()
    {
        if (Id > 0)
        {
            // Cargar cliente existente
            // TODO: Cargar desde base de datos
            cliente = new Cliente
            {
                Id = Id,
                Tipo = TipoCliente.Particular,
                Nombre = "Juan",
                Apellidos = "Pérez",
                NIF = "12345678A",
                Telefono = "600123456",
                Email = "juan@example.com",
                Activo = true
            };
        }
        else
        {
            cliente = new Cliente { FechaRegistro = DateTime.Now, Activo = true };
        }
    }

    private void Guardar()
    {
        // TODO: Guardar en base de datos
        NavigationManager.NavigateTo("/clientes");
    }

    private void Volver()
    {
        NavigationManager.NavigateTo("/clientes");
    }
}
